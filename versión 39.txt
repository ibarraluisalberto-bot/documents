versión 39

<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portal Corporativo Interno - MVC</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        /* Tema Claro */
        body.tema-claro {
            background: #ffffff;
            color: #1a1a1a;
        }

        body.tema-claro .sidebar {
            background: #f8f9fa;
            color: #1a1a1a;
        }

        body.tema-claro .sidebar-header {
            background: #e9ecef;
        }

        body.tema-claro .menu-link {
            color: #1a1a1a;
        }

        body.tema-claro .menu-link:hover {
            background: #e9ecef;
        }

        body.tema-claro .submenu {
            background: #e9ecef;
        }

        body.tema-claro .submenu-link {
            color: #495057;
        }

        body.tema-claro .navbar {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        body.tema-claro main {
            background: #ffffff;
        }

        body.tema-claro table th {
            background: #e9ecef;
            color: #1a1a1a;
        }

        body.tema-claro .region-card {
            background: #f8f9fa;
        }

        /* Tema Oscuro */
        body.tema-oscuro {
            background: #1a1a1a;
            color: #e0e0e0;
        }

        body.tema-oscuro .sidebar {
            background: #0d1117;
            color: #c9d1d9;
        }

        body.tema-oscuro .sidebar-header {
            background: #161b22;
        }

        body.tema-oscuro .menu-link {
            color: #c9d1d9;
        }

        body.tema-oscuro .menu-link:hover {
            background: #21262d;
        }

        body.tema-oscuro .menu-link.active {
            background: #1f6feb;
        }

        body.tema-oscuro .submenu {
            background: #161b22;
        }

        body.tema-oscuro .submenu-link {
            color: #8b949e;
        }

        body.tema-oscuro .submenu-link:hover {
            background: #21262d;
            color: #c9d1d9;
        }

        body.tema-oscuro .navbar {
            background: #0d1117;
            border-bottom: 1px solid #30363d;
        }

        body.tema-oscuro .navbar-title {
            color: #c9d1d9;
        }

        body.tema-oscuro .user-info {
            color: #8b949e;
        }

        body.tema-oscuro main {
            background: #0d1117;
        }

        body.tema-oscuro h2, body.tema-oscuro h3, body.tema-oscuro h4 {
            color: #c9d1d9;
        }

        body.tema-oscuro table {
            background: #161b22;
            color: #c9d1d9;
        }

        body.tema-oscuro table th {
            background: #21262d;
            color: #c9d1d9;
        }

        body.tema-oscuro table td {
            border-bottom: 1px solid #30363d;
        }

        body.tema-oscuro tr:hover {
            background: #161b22;
        }

        body.tema-oscuro .form-group input,
        body.tema-oscuro .form-group select,
        body.tema-oscuro .form-group textarea {
            background: #0d1117;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }

        body.tema-oscuro .form-group label {
            color: #c9d1d9;
        }

        body.tema-oscuro .region-card {
            background: #161b22;
            color: #c9d1d9;
        }

        body.tema-oscuro .region-name {
            color: #c9d1d9;
        }

        body.tema-oscuro .region-value {
            color: #c9d1d9;
        }

        body.tema-oscuro .feature-card {
            background: #161b22;
        }

        body.tema-oscuro .feature-title {
            color: #c9d1d9;
        }

        body.tema-oscuro .feature-description {
            color: #8b949e;
        }

        body.tema-oscuro .welcome-title {
            color: #c9d1d9;
        }

        body.tema-oscuro .welcome-subtitle {
            color: #8b949e;
        }

        body.tema-oscuro .modal-content {
            background: #161b22;
            color: #c9d1d9;
        }

        body.tema-oscuro .modal-title {
            color: #c9d1d9;
        }

        body.tema-oscuro .calendar {
            background: #161b22;
        }

        body.tema-oscuro .calendar-day {
            border: 1px solid #30363d;
            color: #c9d1d9;
        }

        body.tema-oscuro .calendar-day:hover {
            background: #21262d;
        }

        body.tema-oscuro .filters {
            background: #161b22;
        }

        body.tema-oscuro .info-box {
            background: #1f2937;
            color: #c9d1d9;
        }

        body.tema-oscuro .dashboard-subtitle {
            color: #8b949e;
        }

        body.tema-oscuro .permiso-card {
            background: #161b22;
            border-color: #30363d;
        }

        body.tema-oscuro .permiso-modulo-titulo {
            color: #c9d1d9;
        }

        .portal-container {
            display: flex;
            height: 100%;
            width: 100%;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: #2c3e50;
            color: white;
            height: 100%;
            overflow-y: auto;
            transition: transform 0.3s ease;
            position: fixed;
            z-index: 999;
            transform: translateX(-100%);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            padding: 20px;
            background: #1a252f;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .portal-logo {
            max-width: 180px;
            max-height: 70px;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
        }

        #logoContainer {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .navbar-logo {
            max-width: 80px;
            max-height: 80px;
            width: auto;
            height: auto;
            object-fit: contain;
            display: block;
        }

        #navbarLogoContainer {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu {
            list-style: none;
        }

        .menu-item {
            position: relative;
        }

        .menu-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        .menu-link:hover {
            background: #34495e;
        }

        .menu-link.active {
            background: #3498db;
        }

        .submenu {
            list-style: none;
            background: #1a252f;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.open {
            max-height: 500px;
        }

        .submenu-link {
            display: block;
            padding: 12px 20px 12px 40px;
            color: #bdc3c7;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        .submenu-link:hover {
            background: #2c3e50;
            color: white;
        }

        .arrow {
            transition: transform 0.3s;
        }

        .arrow.rotated {
            transform: rotate(90deg);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
            width: 100%;
        }

        .navbar {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hamburger {
            display: flex;
            flex-direction: column;
            cursor: pointer;
            gap: 4px;
        }

        .hamburger span {
            width: 25px;
            height: 3px;
            background: #333;
            transition: 0.3s;
        }

        .home-btn {
            display: none;
        }

        .navbar-title {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #7f8c8d;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #3498db;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: #f5f7fa;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #95a5a6;
        }

        .close-modal:hover {
            color: #333;
        }

        /* Dashboard Styles */
        .dashboard-subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .region-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .region-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .region-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .region-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .region-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .region-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .region-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
        }

        .chart-container {
            height: 100px;
            margin-top: 15px;
        }

        .chart-svg {
            width: 100%;
            height: 100%;
        }

        /* Calendar */
        .calendar {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ecf0f1;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar-day:hover {
            background: #ecf0f1;
        }

        .calendar-day.has-event {
            background: #3498db;
            color: white;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-item {
            flex: 1;
            min-width: 150px;
        }

        /* Cronograma Table */
        .cronograma-table {
            overflow-x: auto;
        }

        .cronograma-table table {
            min-width: 1200px;
        }

        .status-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            display: inline-block;
        }

        .status-liberado {
            background: #27ae60;
        }

        .status-prototipo {
            background: #f39c12;
        }

        /* Toast Messages */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 9999;
            color: white;
            animation: slideIn 0.3s ease;
        }

        .toast-success {
            background: #27ae60;
        }

        .toast-error {
            background: #e74c3c;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Info Box */
        .info-box {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .info-box p {
            margin: 0;
            color: #2c3e50;
            font-size: 14px;
        }

        /* Overlay para cerrar men     */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
        }

        .sidebar-overlay.open {
            display: block;
        }

        /* Welcome Screen Styles */
        .welcome-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
            padding: 40px 20px;
        }

        .welcome-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            animation: float 3s ease-in-out infinite;
        }

        .welcome-icon svg {
            width: 60px;
            height: 60px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .welcome-title {
            font-size: 42px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 50px;
            line-height: 1.6;
        }

        .welcome-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .feature-icon svg {
            width: 32px;
            height: 32px;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .feature-description {
            font-size: 14px;
            color: #7f8c8d;
            line-height: 1.6;
        }

        /* Estilos de Configuración */
        .config-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        body.tema-oscuro .config-section {
            background: #161b22;
        }

        .config-section h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 18px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        body.tema-oscuro .config-section h3 {
            color: #c9d1d9;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        body.tema-oscuro .upload-area {
            background: #0d1117;
            border-color: #1f6feb;
        }

        .upload-area:hover {
            background: #e8f4f8;
            border-color: #2980b9;
        }

        body.tema-oscuro .upload-area:hover {
            background: #161b22;
        }

        .upload-area.has-image {
            padding: 20px;
            border-style: solid;
        }

        .preview-container {
            margin-top: 20px;
            text-align: center;
        }

        .logo-preview {
            max-width: 200px;
            max-height: 100px;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .avatar-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #3498db;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .theme-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .theme-option {
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        body.tema-oscuro .theme-option {
            background: #0d1117;
            border-color: #30363d;
        }

        .theme-option:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2);
        }

        .theme-option.active {
            border-color: #3498db;
            background: #e8f4f8;
        }

        body.tema-oscuro .theme-option.active {
            background: #1f2937;
            border-color: #1f6feb;
        }

        .theme-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .theme-name {
            font-weight: 600;
            color: #2c3e50;
        }

        body.tema-oscuro .theme-name {
            color: #c9d1d9;
        }

        .remove-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        /* Visor de Documentos */
        .documento-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        body.tema-oscuro .documento-item {
            background: #21262d;
        }

        .documento-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        body.tema-oscuro .documento-item:hover {
            background: #30363d;
        }

        .documento-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .documento-icono {
            font-size: 32px;
        }

        .documento-detalles {
            display: flex;
            flex-direction: column;
        }

        .documento-nombre {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 4px;
        }

        body.tema-oscuro .documento-nombre {
            color: #c9d1d9;
        }

        .documento-tamano {
            font-size: 12px;
            color: #7f8c8d;
        }

        .documento-acciones {
            display: flex;
            gap: 8px;
        }

        .preview-frame {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 15px;
        }

        body.tema-oscuro .preview-frame {
            border-color: #30363d;
        }

        /* Estilos para Gestión de Perfiles */
        .permisos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .permiso-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .permiso-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .permiso-modulo-titulo {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .permiso-accion {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }

        .permiso-accion input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .permiso-accion label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            color: #555;
        }

        /* Responsive */
        @media (max-width: 768px) {
            main {
                padding: 20px;
            }

            .navbar {
                padding: 15px 20px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }

            .welcome-title {
                font-size: 32px;
            }

            .welcome-features {
                grid-template-columns: 1fr;
            }

            .user-info {
                font-size: 12px;
            }

            .user-avatar {
                width: 35px;
                height: 35px;
            }

            .permisos-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="portal-container"><!-- Overlay para cerrar menú -->
   <div class="sidebar-overlay" id="sidebarOverlay" onclick="UIController.toggleSidebar()"></div><!-- Sidebar -->
   <aside class="sidebar" id="sidebar">
    <div class="sidebar-header" id="sidebarHeader">
     <div id="logoContainer"></div><span id="menuTitle">Menú</span>
    </div>
    <nav id="menuNav"><!-- Menu will be rendered by View -->
    </nav>
   </aside><!-- Main Content -->
   <div class="main-content">
    <header class="navbar">
     <div class="hamburger" id="hamburger" onclick="UIController.toggleSidebar()"><span></span> <span></span> <span></span>
     </div>
     <div style="display: flex; align-items: center; gap: 15px; cursor: pointer;" onclick="UIController.irAPantallaPrincipal()">
      <div id="navbarLogoContainer"></div>
      <div class="navbar-title">
       Sistema de Ideas de Mejora
      </div>
     </div>
     <div class="user-info" id="userInfo">
      Usuario: Admin<br><span style="font-size: 12px; color: #95a5a6;">Puesto: --- | Área: ---</span>
     </div>
    </header>
    <main id="main">
     <h2>Bienvenido al Portal Corporativo</h2>
     <p>Selecciona una opción del menú para comenzar.</p>
    </main>
   </div>
  </div><!-- Modal -->
  <div class="modal" id="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 class="modal-title" id="modal-title">Título del Modal</h3><span class="close-modal" onclick="UIController.cerrarModal()">×</span>
    </div>
    <div id="modal-body"><!-- Contenido dinámico -->
    </div>
   </div>
  </div>
  <script>
        // =============================================
        // MODELOS (Models)
        // =============================================
        
        /**
         * Modelo de Usuario
         */
        class UsuarioModel {
            constructor() {
                this.colaborador = 'LUIS ALBERTO IBARRA GONZALEZ';
                this.clave = '1956';
                this.puesto = 'Analista de Tecnologias';
                this.area = 'TECNOLOGÍAS DE INFORMACIÓN';
                this.gerencia = 'Tecnologias de Información';
                this.perfil = 'Master'; // 'Master', 'Administrador', 'Gerente', 'Colaborador'
            }

            setPerfil(perfil) {
                this.perfil = perfil;
            }

            getPerfil() {
                return this.perfil;
            }

            getInfo() {
                return {
                    colaborador: this.colaborador,
                    clave: this.clave,
                    puesto: this.puesto,
                    area: this.area,
                    gerencia: this.gerencia,
                    perfil: this.perfil
                };
            }
        }

        /**
         * Modelo de Catálogos
         */
        class CatalogoModel {
            constructor() {
                this.catalogos = {
                    fuentesGeneracion: [
                        'An  lisis interno',
                        'Retroalimentación de cliente',
                        'Auditoría',
                        'Sugerencia de colaborador',
                        'Benchmarking',
                        'Revisión de procesos'
                    ],
                    impactos: [
                        'Reducción de costos',
                        'Mejora de calidad',
                        'Incremento de productividad',
                        'Satisfacción del cliente',
                        'Reducción de tiempo',
                        'Reducción de errores'
                    ],
                    areas: [
                        { nombre: 'ALMACÉN', nomenclatura: 'AL' },
                        { nombre: 'CALIDAD', nomenclatura: 'CA' },
                        { nombre: 'FINANZAS', nomenclatura: 'CF' },
                        { nombre: 'DIFUSIÓN Y MERCADOTECNIA', nomenclatura: 'DF' },
                        { nombre: 'DIRECCIÓN GENERAL', nomenclatura: 'DG' },
                        { nombre: 'GERENTE DE DIFUSIÓN Y MERCADOTECNIA', nomenclatura: 'DI' },
                        { nombre: 'OPERACIONES', nomenclatura: 'OP' },
                        { nombre: 'RECURSOS HUMANOS', nomenclatura: 'RH' },
                        { nombre: 'SERVICIO AL CLIENTE', nomenclatura: 'SC' },
                        { nombre: 'SOPORTE A VENTAS', nomenclatura: 'SV' },
                        { nombre: 'TECNOLOGÍAS DE INFORMACIÓN', nomenclatura: 'TI' },
                        { nombre: 'VENTAS DOMICILIO', nomenclatura: 'VD' },
                        { nombre: 'GERENTE DE VENTAS', nomenclatura: 'VE' },
                        { nombre: 'VEHÍCULOS', nomenclatura: 'VH' },
                        { nombre: 'VENTAS MAYOREO', nomenclatura: 'VM' },
                        { nombre: 'VENTAS DETALLE', nomenclatura: 'VT' }
                    ]
                };
            }

            obtenerCatalogo(nombre) {
                return this.catalogos[nombre] || [];
            }

            agregarOpcion(catalogo, opcion) {
                if (this.catalogos[catalogo]) {
                    if (catalogo === 'areas') {
                        const existe = this.catalogos.areas.some(a => 
                            a.nombre === opcion.nombre || a.nomenclatura === opcion.nomenclatura
                        );
                        if (!existe) {
                            this.catalogos.areas.push(opcion);
                            return true;
                        }
                    } else {
                        if (!this.catalogos[catalogo].includes(opcion)) {
                            this.catalogos[catalogo].push(opcion);
                            return true;
                        }
                    }
                }
                return false;
            }

            eliminarOpcion(catalogo, opcion) {
                if (this.catalogos[catalogo]) {
                    if (catalogo === 'areas') {
                        const index = this.catalogos.areas.findIndex(a => 
                            a.nombre === opcion || a.nomenclatura === opcion
                        );
                        if (index !== -1) {
                            this.catalogos.areas.splice(index, 1);
                            return true;
                        }
                    } else {
                        const index = this.catalogos[catalogo].indexOf(opcion);
                        if (index !== -1) {
                            this.catalogos[catalogo].splice(index, 1);
                            return true;
                        }
                    }
                }
                return false;
            }

            obtenerTodosCatalogos() {
                return this.catalogos;
            }

            obtenerNomenclaturaArea(nombreArea) {
                const area = this.catalogos.areas.find(a => a.nombre === nombreArea);
                return area ? area.nomenclatura : '';
            }
        }

        /**
         * Modelo de Ciclo
         */
        class CicloModel {
            constructor() {
                this.ciclos = [];
                this.contadoresPorArea = {};
            }

            crear(cicloData) {
                const nomenclatura = cicloData.nomenclatura || '';
                
                if (!this.contadoresPorArea[nomenclatura]) {
                    this.contadoresPorArea[nomenclatura] = 0;
                }
                this.contadoresPorArea[nomenclatura]++;
                
                const folio = this.contadoresPorArea[nomenclatura];
                const codigo = `${nomenclatura}-${folio}`;
                
                const ciclo = {
                    id: Date.now(),
                    codigo: codigo,
                    folio: folio,
                    ...cicloData,
                    estatus: 'Abierto',
                    fechaRegistro: new Date().toLocaleDateString()
                };
                this.ciclos.push(ciclo);
                return ciclo;
            }

            obtenerTodos() {
                return this.ciclos;
            }

            obtenerPorColaborador(colaborador) {
                return this.ciclos.filter(c => c.colaborador === colaborador);
            }

            obtenerPorId(id) {
                return this.ciclos.find(c => c.id === id);
            }

            actualizar(id, cicloData) {
                const index = this.ciclos.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.ciclos[index] = {
                        ...this.ciclos[index],
                        ...cicloData
                    };
                    return this.ciclos[index];
                }
                return null;
            }

            actualizarEstatus(id, nuevoEstatus) {
                const index = this.ciclos.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.ciclos[index].estatus = nuevoEstatus;
                    return this.ciclos[index];
                }
                return null;
            }

            eliminar(id) {
                const index = this.ciclos.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.ciclos.splice(index, 1);
                    return true;
                }
                return false;
            }
        }

        /**
         * Modelo de Perfiles con permisos granulares
         */
        class PerfilModel {
            constructor() {
                this.perfiles = {
                    'Master': {
                        nombre: 'Master',
                        descripcion: 'Acceso completo al sistema',
                        permisos: {
                            ideasMejora: {
                                acceso: true,
                                registrar: true,
                                modificar: true,
                                eliminar: true,
                                verTodas: true
                            },
                            administrarPerfiles: {
                                acceso: true,
                                modificar: true
                            },
                            seguimiento: {
                                acceso: true,
                                modificar: true,
                                exportar: true
                            },
                            agenda: {
                                acceso: true,
                                crear: true,
                                modificar: true,
                                eliminar: true
                            },
                            cronograma: {
                                acceso: true,
                                modificar: true,
                                exportar: true
                            },
                            dashboard: {
                                acceso: true,
                                exportar: true
                            },
                            catalogos: {
                                acceso: true,
                                agregar: true,
                                eliminar: true
                            },
                            configuracion: {
                                acceso: true,
                                gestionPerfiles: true
                            }
                        }
                    },
                    'Administrador': {
                        nombre: 'Administrador',
                        descripcion: 'Gestión completa excepto perfiles de sistema',
                        permisos: {
                            ideasMejora: {
                                acceso: true,
                                registrar: true,
                                modificar: true,
                                eliminar: true,
                                verTodas: true
                            },
                            administrarPerfiles: {
                                acceso: true,
                                modificar: true
                            },
                            seguimiento: {
                                acceso: true,
                                modificar: true,
                                exportar: true
                            },
                            agenda: {
                                acceso: true,
                                crear: true,
                                modificar: true,
                                eliminar: true
                            },
                            cronograma: {
                                acceso: true,
                                modificar: true,
                                exportar: true
                            },
                            dashboard: {
                                acceso: true,
                                exportar: true
                            },
                            catalogos: {
                                acceso: true,
                                agregar: true,
                                eliminar: true
                            },
                            configuracion: {
                                acceso: false,
                                gestionPerfiles: false
                            }
                        }
                    },
                    'Gerente': {
                        nombre: 'Gerente',
                        descripcion: 'Visualización y seguimiento',
                        permisos: {
                            ideasMejora: {
                                acceso: true,
                                registrar: true,
                                modificar: false,
                                eliminar: false,
                                verTodas: true
                            },
                            administrarPerfiles: {
                                acceso: false,
                                modificar: false
                            },
                            seguimiento: {
                                acceso: true,
                                modificar: false,
                                exportar: true
                            },
                            agenda: {
                                acceso: true,
                                crear: true,
                                modificar: true,
                                eliminar: true
                            },
                            cronograma: {
                                acceso: true,
                                modificar: false,
                                exportar: true
                            },
                            dashboard: {
                                acceso: true,
                                exportar: true
                            },
                            catalogos: {
                                acceso: false,
                                agregar: false,
                                eliminar: false
                            },
                            configuracion: {
                                acceso: false,
                                gestionPerfiles: false
                            }
                        }
                    },
                    'Colaborador': {
                        nombre: 'Colaborador',
                        descripcion: 'Registro de ideas propias',
                        permisos: {
                            ideasMejora: {
                                acceso: true,
                                registrar: true,
                                modificar: true,
                                eliminar: false,
                                verTodas: false
                            },
                            administrarPerfiles: {
                                acceso: false,
                                modificar: false
                            },
                            seguimiento: {
                                acceso: false,
                                modificar: false,
                                exportar: false
                            },
                            agenda: {
                                acceso: false,
                                crear: false,
                                modificar: false,
                                eliminar: false
                            },
                            cronograma: {
                                acceso: false,
                                modificar: false,
                                exportar: false
                            },
                            dashboard: {
                                acceso: false,
                                exportar: false
                            },
                            catalogos: {
                                acceso: false,
                                agregar: false,
                                eliminar: false
                            },
                            configuracion: {
                                acceso: false,
                                gestionPerfiles: false
                            }
                        }
                    }
                };
            }

            obtenerPerfil(nombre) {
                return this.perfiles[nombre];
            }

            obtenerTodos() {
                return Object.values(this.perfiles);
            }

            obtenerNombresPerfiles() {
                return Object.keys(this.perfiles);
            }

            tienePermiso(nombrePerfil, modulo, accion = null) {
                const perfil = this.perfiles[nombrePerfil];
                if (!perfil) return false;
                
                if (accion) {
                    return perfil.permisos[modulo] && perfil.permisos[modulo][accion];
                }
                
                return perfil.permisos[modulo] && perfil.permisos[modulo].acceso;
            }

            actualizarPerfil(nombrePerfil, descripcion, permisos) {
                if (this.perfiles[nombrePerfil]) {
                    this.perfiles[nombrePerfil].descripcion = descripcion;
                    this.perfiles[nombrePerfil].permisos = permisos;
                    return true;
                }
                return false;
            }
        }

        /**
         * Modelo de Configuración
         */
        class ConfiguracionModel {
            constructor() {
                this.config = {
                    logo: null,
                    avatar: null,
                    tema: 'predeterminado'
                };
                this.cargarConfiguracion();
            }

            cargarConfiguracion() {
                const configGuardada = localStorage.getItem('portalConfig');
                if (configGuardada) {
                    this.config = JSON.parse(configGuardada);
                }
            }

            guardarConfiguracion() {
                localStorage.setItem('portalConfig', JSON.stringify(this.config));
            }

            setLogo(logoDataUrl) {
                this.config.logo = logoDataUrl;
                this.guardarConfiguracion();
            }

            setAvatar(avatarDataUrl) {
                this.config.avatar = avatarDataUrl;
                this.guardarConfiguracion();
            }

            setTema(tema) {
                this.config.tema = tema;
                this.guardarConfiguracion();
            }

            getConfig() {
                return this.config;
            }
        }

        /**
         * Modelo de Evento (Agenda)
         */
        class EventoModel {
            constructor() {
                this.eventos = [];
            }

            crear(eventoData) {
                const evento = {
                    id: Date.now(),
                    ...eventoData
                };
                this.eventos.push(evento);
                return evento;
            }

            obtenerTodos() {
                return this.eventos;
            }

            obtenerPorFecha(fecha) {
                return this.eventos.filter(e => e.fecha === fecha);
            }
        }

        /**
         * Modelo de Folio (Seguimiento)
         */
        class FolioModel {
            constructor() {
                this.folios = {
                    'FOL-001': {
                        folio: 'FOL-001',
                        ideaMejora: 'Optimización del proceso de login',
                        estatusGeneral: 'En desarrollo',
                        estatusDiseño: 'Completado',
                        observaciones: 'Se requiere validación de seguridad',
                        seguimientos: [
                            { fecha: '2024-01-15', comentario: 'Inicio del proyecto' },
                            { fecha: '2024-02-20', comentario: 'Diseño aprobado' }
                        ]
                    },
                    'FOL-002': {
                        folio: 'FOL-002',
                        ideaMejora: 'Implementación de dashboard analítico',
                        estatusGeneral: 'Prototipo',
                        estatusDiseño: 'En progreso',
                        observaciones: 'Pendiente definir métricas',
                        seguimientos: [
                            { fecha: '2024-01-10', comentario: 'Reunión inicial con stakeholders' }
                        ]
                    },
                    'FOL-003': {
                        folio: 'FOL-003',
                        ideaMejora: 'Sistema de notificaciones push',
                        estatusGeneral: 'Liberado',
                        estatusDiseño: 'Completado',
                        observaciones: 'Funcionando correctamente',
                        seguimientos: [
                            { fecha: '2024-01-05', comentario: 'An    lisis de requisitos' },
                            { fecha: '2024-02-15', comentario: 'Desarrollo completado' },
                            { fecha: '2024-03-01', comentario: 'Liberado a producción' }
                        ]
                    }
                };
            }

            obtenerPorFolio(folio) {
                return this.folios[folio];
            }

            obtenerTodos() {
                return Object.values(this.folios);
            }
        }

        /**
         * Modelo de Cronograma
         */
        class CronogramaModel {
            constructor() {
                this.items = [
                    {
                        departamento: 'TI',
                        implementador: 'Juan Pérez',
                        clave: 'PRY-001',
                        folio: 'FOL-001',
                        estatusTI: 'Desarrollo',
                        meses: { '02': 'prototipo', '03': 'prototipo', '04': 'liberado' }
                    },
                    {
                        departamento: 'RRHH',
                        implementador: 'María García',
                        clave: 'PRY-002',
                        folio: 'FOL-002',
                        estatusTI: 'Diseño',
                        meses: { '01': 'prototipo', '02': 'prototipo' }
                    },
                    {
                        departamento: 'Operaciones',
                        implementador: 'Carlos López',
                        clave: 'PRY-003',
                        folio: 'FOL-003',
                        estatusTI: 'Liberado',
                        meses: { '02': 'liberado', '03': 'liberado' }
                    }
                ];
            }

            obtenerTodos() {
                return this.items;
            }

            filtrar(filtros) {
                return this.items.filter(item => {
                    if (filtros.tipo && item.estatusTI !== filtros.tipo) return false;
                    if (filtros.implementador && item.implementador !== filtros.implementador) return false;
                    return true;
                });
            }
        }

        // =============================================
        // VISTAS (Views)
        // =============================================

        /**
         * Vista del Menú
         */
        class MenuView {
            renderMenu(perfil) {
                const perfilData = app.perfilModel.obtenerPerfil(perfil);
                const permisos = perfilData ? perfilData.permisos : {};

                const menuItems = [
                    {
                        id: 'ciclos',
                        titulo: 'Ideas de Mejora',
                        modulo: 'ideasMejora',
                        submenu: [
                            { texto: 'Registrar Ideas de Mejora', accion: 'CicloController.mostrarFormularioRegistro()', permiso: 'registrar' },
                            { texto: 'Ideas de Mejora Registradas', accion: 'CicloController.mostrarListado()' }
                        ]
                    },
                    {
                        id: 'perfiles',
                        titulo: 'Administrar Perfiles',
                        modulo: 'administrarPerfiles',
                        submenu: [
                            { texto: 'Administrar Perfil MejorISSA', accion: 'UsuarioController.mostrarPerfil()' }
                        ]
                    },
                    {
                        id: 'seguimiento',
                        titulo: 'Visualización de Seguimiento',
                        modulo: 'seguimiento',
                        submenu: [
                            { texto: 'Seguimiento', accion: 'SeguimientoController.mostrarSeguimiento()' }
                        ]
                    },
                    {
                        id: 'agenda',
                        titulo: 'Agenda Electrónica',
                        modulo: 'agenda',
                        submenu: [
                            { texto: 'Agenda', accion: 'AgendaController.mostrarAgenda()' }
                        ]
                    },
                    {
                        id: 'cronograma',
                        titulo: 'Cronograma Prototipos/Liberaciones',
                        modulo: 'cronograma',
                        submenu: [
                            { texto: 'Ver Cronograma', accion: 'CronogramaController.mostrarCronograma()' }
                        ]
                    },
                    {
                        id: 'dashboard',
                        titulo: 'Dashboard',
                        modulo: 'dashboard',
                        accion: 'DashboardController.mostrarDashboard()'
                    },
                    {
                        id: 'catalogos',
                        titulo: 'Administrar Catálogos',
                        modulo: 'catalogos',
                        accion: 'CatalogoController.mostrarMenuCatalogos()'
                    },
                    {
                        id: 'configuracion',
                        titulo: 'Configuración',
                        modulo: 'configuracion',
                        submenu: [
                            { texto: 'Personalización del Portal', accion: 'ConfiguracionController.mostrarConfiguracion()' },
                            { texto: '   Administrar Perfiles', accion: 'PerfilController.mostrarGestionPerfiles()', permiso: 'gestionPerfiles' }
                        ]
                    },
                    {
                        id: 'salir',
                        titulo: 'Salir',
                        accion: 'UIController.salir()'
                    }
                ];

                let html = '<ul class="menu">';

                menuItems.forEach(item => {
                    if (item.modulo && !permisos[item.modulo]?.acceso) return;

                    html += '<li class="menu-item">';

                    if (item.submenu) {
                        html += `
                            <div class="menu-link" onclick="UIController.toggleSubmenu('${item.id}-menu')">
                                <span>${item.titulo}</span>
                                <span class="arrow" id="${item.id}-arrow">▶</span>
                            </div>
                            <ul class="submenu" id="${item.id}-menu">
                        `;
                        item.submenu.forEach(sub => {
                            if (sub.permiso && !permisos[item.modulo][sub.permiso]) return;
                            html += `<li><a class="submenu-link" onclick="${sub.accion}; UIController.cerrarSidebar();">${sub.texto}</a></li>`;
                        });
                        html += '</ul>';
                    } else {
                        html += `
                            <a class="menu-link" onclick="${item.accion}; UIController.cerrarSidebar();">
                                <span>${item.titulo}</span>
                            </a>
                        `;
                    }

                    html += '</li>';
                });

                html += '</ul>';
                return html;
            }
        }

        /**
         * Vista de Ciclos
         */
        class CicloView {
            renderFormularioRegistro(colaborador, fuentesGeneracion, impactos) {
                const opcionesFuentes = fuentesGeneracion.map(f => `<option value="${f}">${f}</option>`).join('');
                const opcionesImpactos = impactos.map(i => `<option value="${i}">${i}</option>`).join('');
                
                return `
                    <h2>Registrar Idea de Mejora</h2>
                    <form id="formCiclo" onsubmit="CicloController.guardarCiclo(event)">
                        <div class="form-group">
                            <label for="nombreColaborador">Nombre del Colaborador</label>
                            <input type="text" id="nombreColaborador" value="${colaborador}" readonly style="background: #ecf0f1;">
                        </div>
                        <div class="form-group">
                            <label for="fuenteGeneracion">Fuentes de Generación</label>
                            <select id="fuenteGeneracion" required>
                                <option value="">Seleccionar...</option>
                                ${opcionesFuentes}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="descripcionIdea">Describe de manera clara tu idea de mejora</label>
                            <textarea id="descripcionIdea" required style="min-height: 100px; resize: vertical;"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="situacionActual">¿Cuál es la situación actualmente?</label>
                            <textarea id="situacionActual" required style="min-height: 100px; resize: vertical;"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="impacto">Impacto de tu idea</label>
                            <select id="impacto" required>
                                <option value="">Seleccionar...</option>
                                ${opcionesImpactos}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="documentacion">Documentación (opcional)</label>
                            <input type="file" id="documentacion" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png" multiple>
                            <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                                Formatos permitidos: PDF, Word, Excel, PowerPoint, TXT, JPG, PNG. Puedes seleccionar múltiples archivos.
                            </small>
                            <div id="archivosSeleccionados" style="margin-top: 10px;"></div>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar</button>
                    </form>
                `;
            }

            renderFormularioModificacion(ciclo, fuentesGeneracion, impactos) {
                const opcionesFuentes = fuentesGeneracion.map(f => 
                    `<option value="${f}" ${ciclo.fuenteGeneracion === f ? 'selected' : ''}>${f}</option>`
                ).join('');
                const opcionesImpactos = impactos.map(i => 
                    `<option value="${i}" ${ciclo.impacto === i ? 'selected' : ''}>${i}</option>`
                ).join('');
                
                return `
                    <h2>Modificar Idea de Mejora</h2>
                    <form id="formModificarCiclo" onsubmit="CicloController.guardarModificacion(event, ${ciclo.id})">
                        <div class="form-group">
                            <label for="nombreColaborador">Nombre del Colaborador</label>
                            <input type="text" id="nombreColaborador" value="${ciclo.colaborador}" readonly style="background: #ecf0f1;">
                        </div>
                        <div class="form-group">
                            <label for="fuenteGeneracion">Fuentes de Generación</label>
                            <select id="fuenteGeneracion" required>
                                <option value="">Seleccionar...</option>
                                ${opcionesFuentes}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="descripcionIdea">Describe de manera clara tu idea de mejora</label>
                            <textarea id="descripcionIdea" required style="min-height: 100px; resize: vertical;">${ciclo.descripcionIdea}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="situacionActual">¿Cuál es la situación actualmente?</label>
                            <textarea id="situacionActual" required style="min-height: 100px; resize: vertical;">${ciclo.situacionActual}</textarea>
                        </div>
                        <div class="form-group">
                            <label for="impacto">Impacto de tu idea</label>
                            <select id="impacto" required>
                                <option value="">Seleccionar...</option>
                                ${opcionesImpactos}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="requiereDesarrolloTI">¿Requiere desarrollo de TI?</label>
                            <select id="requiereDesarrolloTI" required>
                                <option value="">Seleccionar...</option>
                                <option value="SI" ${ciclo.requiereDesarrolloTI === 'SI' ? 'selected' : ''}>SI</option>
                                <option value="NO" ${ciclo.requiereDesarrolloTI === 'NO' ? 'selected' : ''}>NO</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="documentacion">Documentación (opcional)</label>
                            ${ciclo.documentos && ciclo.documentos.length > 0 ? `
                                <div style="margin-bottom: 10px; padding: 10px; background: #e8f4f8; border-radius: 4px;">
                                    <strong>Documentos actuales:</strong>
                                    ${ciclo.documentos.map((doc, index) => `
                                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #ddd;">
                                            <span>📎 ${doc.nombre}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            <input type="file" id="documentacion" accept=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.jpeg,.png" multiple>
                            <small style="color: #7f8c8d; display: block; margin-top: 5px;">
                                Formatos permitidos: PDF, Word, Excel, PowerPoint, TXT, JPG, PNG. Los nuevos archivos se agregarán a los existentes.
                            </small>
                            <div id="archivosSeleccionados" style="margin-top: 10px;"></div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                            <button type="button" class="btn btn-secondary" onclick="CicloController.mostrarListado()">Cancelar</button>
                        </div>
                    </form>
                `;
            }

            renderListado(ciclos, perfilActual) {
                const perfilData = app.perfilModel.obtenerPerfil(perfilActual);
                const puedeModificar = perfilData?.permisos.ideasMejora.modificar || false;
                const puedeEliminar = perfilData?.permisos.ideasMejora.eliminar || false;
                
                let html = `
                    <h2>Ideas de Mejora Registradas</h2>
                    
                    <!-- Filtros de búsqueda -->
                    <div class="filters" style="margin-bottom: 25px;">
                        <div class="filter-item" style="flex: 1.5;">
                            <label for="searchInput" style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Buscar</label>
                            <input type="text" id="searchInput" placeholder="Escriba para buscar..." 
                                   onkeyup="CicloController.aplicarFiltros()" 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div class="filter-item" style="flex: 1;">
                            <label for="searchColumn" style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Buscar en</label>
                            <select id="searchColumn" onchange="CicloController.aplicarFiltros()" 
                                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <option value="todos">Todas las columnas</option>
                                <option value="codigo">Código</option>
                                <option value="colaborador">Colaborador</option>
                                <option value="area">Área</option>
                                <option value="puesto">Puesto</option>
                                <option value="fuenteGeneracion">Fuente de Generación</option>
                                <option value="descripcionIdea">Descripción de la Idea</option>
                                <option value="impacto">Impacto</option>
                            </select>
                        </div>
                        
                        <div class="filter-item" style="flex: 0.8;">
                            <label for="estatusFilter" style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Estatus</label>
                            <select id="estatusFilter" onchange="CicloController.aplicarFiltros()" 
                                    style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                                <option value="todos">Todos</option>
                                <option value="Abierto">Abierto</option>
                                <option value="Cerrado">Cerrado</option>
                            </select>
                        </div>
                        
                        <div class="filter-item" style="flex: 0.9;">
                            <label for="fechaDesde" style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Fecha Desde</label>
                            <input type="date" id="fechaDesde" onchange="CicloController.aplicarFiltros()" 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div class="filter-item" style="flex: 0.9;">
                            <label for="fechaHasta" style="display: block; margin-bottom: 5px; font-weight: 600; color: #2c3e50;">Fecha Hasta</label>
                            <input type="date" id="fechaHasta" onchange="CicloController.aplicarFiltros()" 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        
                        <div class="filter-item" style="flex: 0.5; display: flex; align-items: flex-end;">
                            <button class="btn btn-secondary" onclick="CicloController.limpiarFiltros()" 
                                    style="width: 100%; padding: 10px; white-space: nowrap;">
                                🔄 Limpiar
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px; padding: 10px; background: #e8f4f8; border-radius: 4px;">
                        <span style="font-weight: 600; color: #2c3e50;">Total de registros:</span> 
                        <span id="totalRegistros" style="color: #3498db; font-weight: 700;">${ciclos.length}</span>
                        <span style="margin-left: 20px; font-weight: 600; color: #2c3e50;">Registros mostrados:</span> 
                        <span id="registrosMostrados" style="color: #27ae60; font-weight: 700;">${ciclos.length}</span>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table id="tablaCiclos">
                            <thead>
                                <tr>
                                    <th>Fecha Registro</th>
                                    <th>Código</th>
                                    <th>Colaborador</th>
                                    <th>Área</th>
                                    <th>Puesto</th>
                                    <th>Fuente de Generación</th>
                                    <th>Descripción de la Idea</th>
                                    <th>Situación Actual</th>
                                    <th>Impacto</th>
                                    <th>Estatus</th>
                                    <th>Documentación</th>
                                    ${puedeModificar || puedeEliminar ? '<th style="min-width: 180px;">Opciones</th>' : ''}
                                </tr>
                            </thead>
                            <tbody id="tablaCiclosBody">
                `;

                if (ciclos.length === 0) {
                    const colspan = puedeModificar || puedeEliminar ? '12' : '11';
                    html += `<tr><td colspan="${colspan}" style="text-align:center;">No hay ideas de mejora registradas</td></tr>`;
                } else {
                    ciclos.forEach(ciclo => {
                        const tieneDocumentos = ciclo.documentos && ciclo.documentos.length > 0;
                        html += `
                            <tr class="fila-ciclo" 
                                data-codigo="${ciclo.codigo}" 
                                data-colaborador="${ciclo.colaborador}" 
                                data-area="${ciclo.area}" 
                                data-puesto="${ciclo.puesto}" 
                                data-fuente="${ciclo.fuenteGeneracion}" 
                                data-descripcion="${ciclo.descripcionIdea}" 
                                data-impacto="${ciclo.impacto}" 
                                data-estatus="${ciclo.estatus}"
                                data-fecha="${ciclo.fechaRegistro}">
                                <td>${ciclo.fechaRegistro}</td>
                                <td><strong style="color: #3498db;">${ciclo.codigo}</strong></td>
                                <td>${ciclo.colaborador}</td>
                                <td>${ciclo.area}</td>
                                <td>${ciclo.puesto}</td>
                                <td>${ciclo.fuenteGeneracion}</td>
                                <td>${ciclo.descripcionIdea}</td>
                                <td>${ciclo.situacionActual}</td>
                                <td>${ciclo.impacto}</td>
                                <td><span style="padding: 4px 12px; border-radius: 4px; background: ${ciclo.estatus === 'Abierto' ? '#27ae60' : '#e74c3c'}; color: white; font-size: 12px;">${ciclo.estatus}</span></td>
                                <td style="text-align: center;">
                                    ${tieneDocumentos ? 
                                        `<button class="btn btn-primary" onclick="CicloController.verDocumentos(${ciclo.id})" style="padding: 6px 12px; font-size: 12px;">
                                            📎 Ver (${ciclo.documentos.length})
                                        </button>` :
                                        '<span style="color: #95a5a6;">Sin documentos</span>'
                                    }
                                </td>
                                ${puedeModificar || puedeEliminar ? `
                                    <td>
                                        ${puedeModificar ? `<button class="btn btn-primary" onclick="CicloController.mostrarFormularioModificacion(${ciclo.id})" style="margin-right: 5px;">Modificar</button>` : ''}
                                        ${puedeEliminar ? `<button class="btn btn-danger" onclick="CicloController.confirmarEliminacion(${ciclo.id})">Eliminar</button>` : ''}
                                    </td>
                                ` : ''}
                            </tr>
                        `;
                    });
                }

                html += '</tbody></table></div>';
                return html;
            }
        }

        /**
         * Vista de Catálogos
         */
        class CatalogoView {
            renderMenuCatalogos() {
                return `
                    <h2>Administrar Catálogos</h2>
                    <p style="color: #7f8c8d; margin-bottom: 30px;">Selecciona el catálogo que deseas administrar</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; max-width: 1200px;">
                        <div class="feature-card" onclick="CatalogoController.mostrarCatalogo('fuentesGeneracion')" style="cursor: pointer;">
                            <div class="feature-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                                    <path d="M2 17l10 5 10-5"></path>
                                    <path d="M2 12l10 5 10-5"></path>
                                </svg>
                            </div>
                            <h3 class="feature-title">Fuentes de Generación</h3>
                            <p class="feature-description">Administra las fuentes de generación de ideas de mejora</p>
                        </div>
                        
                        <div class="feature-card" onclick="CatalogoController.mostrarCatalogo('impactos')" style="cursor: pointer;">
                            <div class="feature-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                </svg>
                            </div>
                            <h3 class="feature-title">Impactos</h3>
                            <p class="feature-description">Administra los tipos de impacto de las ideas de mejora</p>
                        </div>
                        
                        <div class="feature-card" onclick="CatalogoController.mostrarCatalogo('areas')" style="cursor: pointer;">
                            <div class="feature-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </div>
                            <h3 class="feature-title">Áreas</h3>
                            <p class="feature-description">Administra las áreas y sus nomenclaturas</p>
                        </div>
                    </div>
                `;
            }

            renderCatalogoIndividual(titulo, nombre, opciones, perfilActual) {
                const perfilData = app.perfilModel.obtenerPerfil(perfilActual);
                const puedeAgregar = perfilData?.permisos.catalogos.agregar || false;
                const puedeEliminar = perfilData?.permisos.catalogos.eliminar || false;
                
                let listaOpciones = '';
                let formularioAgregar = '';
                
                if (nombre === 'areas') {
                    listaOpciones = opciones.map(area => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                            <div>
                                <strong>${area.nombre}</strong>
                                <span style="margin-left: 15px; padding: 2px 8px; background: #3498db; color: white; border-radius: 3px; font-size: 11px;">${area.nomenclatura}</span>
                            </div>
                            ${puedeEliminar ? `<button class="btn btn-danger" onclick="CatalogoController.eliminarOpcion('${nombre}', '${area.nombre}')" style="padding: 5px 10px; font-size: 12px;">Eliminar</button>` : ''}
                        </div>
                    `).join('');
                    
                    if (puedeAgregar) {
                        formularioAgregar = `
                            <form onsubmit="CatalogoController.agregarOpcion(event, '${nombre}')" style="display: flex; flex-direction: column; gap: 10px;">
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" id="nueva-area-nombre" placeholder="Nombre del área..." required style="flex: 2; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                    <input type="text" id="nueva-area-nomenclatura" placeholder="Nomenclatura (ej: TI)..." required maxlength="5" style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px; text-transform: uppercase;">
                                    <button type="submit" class="btn btn-success" style="white-space: nowrap;">Agregar</button>
                                </div>
                                <small style="color: #7f8c8d;">La nomenclatura se usará para generar códigos de ideas (ej: TI-1, TI-2)</small>
                            </form>
                        `;
                    }
                } else {
                    listaOpciones = opciones.map(opcion => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                            <span>${opcion}</span>
                            ${puedeEliminar ? `<button class="btn btn-danger" onclick="CatalogoController.eliminarOpcion('${nombre}', '${opcion}')" style="padding: 5px 10px; font-size: 12px;">Eliminar</button>` : ''}
                        </div>
                    `).join('');
                    
                    if (puedeAgregar) {
                        formularioAgregar = `
                            <form onsubmit="CatalogoController.agregarOpcion(event, '${nombre}')" style="display: flex; gap: 10px;">
                                <input type="text" id="nueva-${nombre}" placeholder="Nueva opción..." required style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <button type="submit" class="btn btn-success">Agregar</button>
                            </form>
                        `;
                    }
                }

                return `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="CatalogoController.mostrarMenuCatalogos()" style="margin-bottom: 15px;">
                            ← Volver al Menú de Catálogos
                        </button>
                    </div>
                    <h2>${titulo}</h2>
                    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-width: 900px;">
                        <div style="margin-bottom: 20px;">
                            ${listaOpciones}
                        </div>
                        ${formularioAgregar}
                    </div>
                `;
            }
        }

        /**
         * Vista de Usuario/Perfil
         */
        class UsuarioView {
            renderPerfil(usuario) {
                const perfiles = app.perfilModel.obtenerNombresPerfiles();
                const opcionesPerfiles = perfiles.map(p => 
                    `<option value="${p}" ${usuario.perfil === p ? 'selected' : ''}>${p}</option>`
                ).join('');

                return `
                    <h2>Administrar Perfil MejorISSA</h2>
                    <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); max-width: 600px;">
                        <h3 style="margin-bottom: 20px; color: #2c3e50;">Información del Usuario</h3>
                        <form id="formPerfil" onsubmit="UsuarioController.guardarPerfil(event)">
                            <div class="form-group">
                                <label for="colaborador">Colaborador</label>
                                <input type="text" id="colaborador" value="${usuario.colaborador}" readonly style="background: #ecf0f1;">
                            </div>
                            <div class="form-group">
                                <label for="clave">Clave</label>
                                <input type="text" id="clave" value="${usuario.clave}" readonly style="background: #ecf0f1;">
                            </div>
                            <div class="form-group">
                                <label for="puesto">Puesto</label>
                                <input type="text" id="puesto" value="${usuario.puesto}" readonly style="background: #ecf0f1;">
                            </div>
                            <div class="form-group">
                                <label for="area">Área</label>
                                <input type="text" id="area" value="${usuario.area}" readonly style="background: #ecf0f1;">
                            </div>
                            <div class="form-group">
                                <label for="gerencia">Gerencia</label>
                                <input type="text" id="gerencia" value="${usuario.gerencia}" readonly style="background: #ecf0f1;">
                            </div>
                            <div class="form-group">
                                <label for="perfil">Perfil</label>
                                <select id="perfil" required>
                                    <option value="">Seleccionar...</option>
                                    ${opcionesPerfiles}
                                </select>
                            </div>
                            <div class="info-box">
                                <p>
                                    <strong>Nota:</strong> Los perfiles determinan el nivel de acceso al portal. 
                                    Cada perfil tiene permisos específicos configurables desde Configuración > Gestión de Perfiles.
                                </p>
                            </div>
                            <button type="submit" class="btn btn-primary">Actualizar Perfil</button>
                        </form>
                    </div>
                `;
            }
        }

        /**
         * Vista de Seguimiento
         */
        class SeguimientoView {
            renderListadoFolios(folios) {
                let html = `
                    <h2>Seguimiento de Ideas de Mejora</h2>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th rowspan="2">Gerencia</th>
                                    <th rowspan="2">Código</th>
                                    <th rowspan="2">Área</th>
                                    <th rowspan="2">Folio</th>
                                    <th rowspan="2">Colaborador</th>
                                    <th rowspan="2">Contrato</th>
                                    <th rowspan="2">Impacto de tu idea</th>
                                    <th rowspan="2">Estatus de idea</th>
                                    <th rowspan="2">Estatus 1</th>
                                    <th rowspan="2">Estatus 2</th>
                                    <th rowspan="2">Aprobación</th>
                                    <th rowspan="2">Implementador TI</th>
                                    <th colspan="2" style="background: #2980b9; border-right: 2px solid #fff;">Prototipo</th>
                                    <th colspan="2" style="background: #2980b9; border-right: 2px solid #fff;">Adecuaciones</th>
                                    <th colspan="2" style="background: #2980b9; border-right: 2px solid #fff;">Liberación</th>
                                    <th rowspan="2">Mes de cierre</th>
                                    <th rowspan="2">Fecha Plan Cierre</th>
                                    <th rowspan="2">Fecha Cierre de idea</th>
                                </tr>
                                <tr>
                                    <th>Fecha Plan</th>
                                    <th style="border-right: 2px solid #ddd;">Fecha Entrega</th>
                                    <th>Fecha Plan</th>
                                    <th style="border-right: 2px solid #ddd;">Fecha entrega</th>
                                    <th>Fecha Plan</th>
                                    <th style="border-right: 2px solid #ddd;">Fecha entrega</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="21" style="text-align: center; padding: 40px; color: #7f8c8d;">
                                        No hay ideas de mejora registradas
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;

                return html;
            }

            renderDetalleFolio(detalle) {
                let seguimientosHtml = '';
                detalle.seguimientos.forEach(seg => {
                    seguimientosHtml += `<p><strong>${seg.fecha}:</strong> ${seg.comentario}</p>`;
                });

                return `
                    <p><strong>Idea de Mejora:</strong> ${detalle.ideaMejora}</p>
                    <p><strong>Estatus General:</strong> ${detalle.estatusGeneral}</p>
                    <p><strong>Estatus de Diseño/Desarrollo:</strong> ${detalle.estatusDiseño}</p>
                    <p><strong>Observaciones:</strong> ${detalle.observaciones}</p>
                    <hr>
                    <h4>Seguimientos:</h4>
                    ${seguimientosHtml}
                `;
            }
        }

        /**
         * Vista de Agenda
         */
        class AgendaView {
            renderAgenda(eventos) {
                return `
                    <h2>Agenda Electrónica</h2>
                    <button class="btn btn-success" onclick="AgendaController.abrirModalEvento()">Agregar Actividad</button>
                    
                    <div class="calendar">
                        <div class="calendar-header">
                            <button class="btn btn-primary">← Anterior</button>
                            <h3>Enero 2024</h3>
                            <button class="btn btn-primary">Siguiente →</button>
                        </div>
                        <div class="calendar-grid">
                            <div style="font-weight: bold; text-align: center;">Dom</div>
                            <div style="font-weight: bold; text-align: center;">Lun</div>
                            <div style="font-weight: bold; text-align: center;">Mar</div>
                            <div style="font-weight: bold; text-align: center;">Mié</div>
                            <div style="font-weight: bold; text-align: center;">Jue</div>
                            <div style="font-weight: bold; text-align: center;">Vie</div>
                            <div style="font-weight: bold; text-align: center;">Sáb</div>
                            ${this.renderDiasCalendario(eventos)}
                        </div>
                    </div>
                `;
            }

            renderDiasCalendario(eventos) {
                let html = '';
                for (let i = 1; i <= 31; i++) {
                    const hasEvent = eventos.some(e => new Date(e.fecha).getDate() === i);
                    html += `<div class="calendar-day ${hasEvent ? 'has-event' : ''}">${i}</div>`;
                }
                return html;
            }

            renderFormularioEvento() {
                return `
                    <form id="formEvento" onsubmit="AgendaController.guardarEvento(event)">
                        <div class="form-group">
                            <label for="tituloEvento">Título</label>
                            <input type="text" id="tituloEvento" required>
                        </div>
                        <div class="form-group">
                            <label for="fechaEvento">Fecha</label>
                            <input type="date" id="fechaEvento" required>
                        </div>
                        <div class="form-group">
                            <label for="horaEvento">Hora</label>
                            <input type="time" id="horaEvento" required>
                        </div>
                        <div class="form-group">
                            <label for="descripcionEvento">Descripción</label>
                            <input type="text" id="descripcionEvento" required>
                        </div>
                        <button type="submit" class="btn btn-success">Guardar</button>
                    </form>
                `;
            }
        }

        /**
         * Vista de Cronograma
         */
        class CronogramaView {
            renderCronograma(items) {
                const meses = ['02.FEB', '03.MAR', '04.ABR', '05.MAY', '06.JUN', '07.JUL', '08.AGO', '09.SEP', '10.OCT', '11.NOV', '12.DIC'];
                
                let html = `
                    <h2>Cronograma de Prototipos y Liberaciones</h2>
                    
                    <div class="filters">
                        <div class="filter-item">
                            <label>Tipo de Plan</label>
                            <select id="filterTipo" onchange="CronogramaController.aplicarFiltros()">
                                <option value="">Todos</option>
                                <option value="Desarrollo">Desarrollo</option>
                                <option value="Diseño">Diseño de Prototipo</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>Año</label>
                            <select id="filterAno">
                                <option value="2024">2024</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>Implementador</label>
                            <select id="filterImplementador" onchange="CronogramaController.aplicarFiltros()">
                                <option value="">Todos</option>
                                <option value="Juan Pérez">Juan Pérez</option>
                                <option value="María García">María García</option>
                                <option value="Carlos L        pez">Carlos López</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="cronograma-table">
                        <table id="tablaCronograma">
                            <thead>
                                <tr>
                                    <th>Departamento</th>
                                    <th>Implementador</th>
                                    <th>Clave</th>
                                    <th>Folio</th>
                                    <th>Estatus TI</th>
                                    ${meses.map(m => `<th>${m}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                `;

                items.forEach(item => {
                    html += `
                        <tr class="cronograma-row" data-tipo="${item.estatusTI}" data-implementador="${item.implementador}">
                            <td>${item.departamento}</td>
                            <td>${item.implementador}</td>
                            <td>${item.clave}</td>
                            <td>${item.folio}</td>
                            <td>${item.estatusTI}</td>
                    `;

                    meses.forEach(mes => {
                        const mesNum = mes.substring(0, 2);
                        const estado = item.meses[mesNum];
                        let contenido = '';
                        if (estado === 'liberado') {
                            contenido = '<span class="status-box status-liberado"></span>';
                        } else if (estado === 'prototipo') {
                            contenido = '<span class="status-box status-prototipo"></span>';
                        }
                        html += `<td style="text-align: center;">${contenido}</td>`;
                    });

                    html += '</tr>';
                });

                html += '</tbody></table></div>';
                return html;
            }
        }

        /**
         * Vista de Home/Bienvenida
         */
        class HomeView {
            renderHome(usuario) {
                return `
                    <div class="welcome-container">
                        <div class="welcome-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                        </div>
                        <h1 class="welcome-title">¡Bienvenido al Portal Corporativo!</h1>
                        <p class="welcome-subtitle">
                            Hola <strong>${usuario.colaborador}</strong>, gestiona todos los procesos de mejora continua desde un solo lugar
                        </p>
                        
                        <div class="welcome-features">
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                </div>
                                <h3 class="feature-title">Gestión de Ciclos</h3>
                                <p class="feature-description">Registra y da seguimiento a todas las ideas de mejora continua</p>
                            </div>
                            
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                </div>
                                <h3 class="feature-title">Agenda Electrónica</h3>
                                <p class="feature-description">Organiza tus actividades y eventos importantes</p>
                            </div>
                            
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                </div>
                                <h3 class="feature-title">Cronogramas</h3>
                                <p class="feature-description">Visualiza prototipos y liberaciones programadas</p>
                            </div>
                            
                            <div class="feature-card">
                                <div class="feature-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                                    </svg>
                                </div>
                                <h3 class="feature-title">Dashboard Analítico</h3>
                                <p class="feature-description">Métricas y estadísticas en tiempo real</p>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        /**
         * Vista de Configuración
         */
        class ConfiguracionView {
            renderConfiguracion(config) {
                const temas = [
                    { id: 'predeterminado', nombre: 'Predeterminado', icono: '⚙️' },
                    { id: 'claro', nombre: 'Claro', icono: '☀️' },
                    { id: 'oscuro', nombre: 'Oscuro', icono: '🌙' }
                ];

                return `
                    <h2>Configuración del Portal</h2>
                    <p style="color: #7f8c8d; margin-bottom: 30px;">Personaliza la apariencia de tu portal</p>

                    <!-- Logo del Portal -->
                    <div class="config-section">
                        <h3>Logo del Portal</h3>
                        <p style="color: #7f8c8d; margin-bottom: 15px; font-size: 14px;">
                            Tamaño recomendado: 200x100 píxeles. Formatos: JPG, PNG, SVG
                        </p>
                        <div class="upload-area ${config.logo ? 'has-image' : ''}" id="logoUploadArea" onclick="document.getElementById('logoInput').click()">
                            ${config.logo ? 
                                `<div class="preview-container">
                                    <img src="${config.logo}" alt="Logo" class="logo-preview">
                                    <br>
                                    <button class="remove-btn" onclick="event.stopPropagation(); ConfiguracionController.eliminarLogo()">Eliminar Logo</button>
                                </div>` :
                                `<div>
                                    <div style="font-size: 48px; margin-bottom: 10px;">📁</div>
                                    <p style="font-weight: 600; color: #2c3e50; margin-bottom: 5px;">Haz clic para subir el logo</p>
                                    <p style="font-size: 13px; color: #95a5a6;">o arrastra y suelta la imagen aquí</p>
                                </div>`
                            }
                        </div>
                        <input type="file" id="logoInput" accept="image/*" style="display: none;" onchange="ConfiguracionController.subirLogo(event)">
                    </div>

                    <!-- Avatar del Usuario -->
                    <div class="config-section">
                        <h3>Avatar del Usuario</h3>
                        <p style="color: #7f8c8d; margin-bottom: 15px; font-size: 14px;">
                            Tamaño recomendado: 150x150 píxeles. La imagen se mostrará de forma circular
                        </p>
                        <div class="upload-area ${config.avatar ? 'has-image' : ''}" id="avatarUploadArea" onclick="document.getElementById('avatarInput').click()">
                            ${config.avatar ? 
                                `<div class="preview-container">
                                    <img src="${config.avatar}" alt="Avatar" class="avatar-preview">
                                    <br>
                                    <button class="remove-btn" onclick="event.stopPropagation(); ConfiguracionController.eliminarAvatar()">Eliminar Avatar</button>
                                </div>` :
                                `<div>
                                    <div style="font-size: 48px; margin-bottom: 10px;">👤</div>
                                    <p style="font-weight: 600; color: #2c3e50; margin-bottom: 5px;">Haz clic para subir tu avatar</p>
                                    <p style="font-size: 13px; color: #95a5a6;">o arrastra y suelta la imagen aquí</p>
                                </div>`
                            }
                        </div>
                        <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="ConfiguracionController.subirAvatar(event)">
                    </div>

                    <!-- Selector de Tema -->
                    <div class="config-section">
                        <h3>Tema del Portal</h3>
                        <p style="color: #7f8c8d; margin-bottom: 15px; font-size: 14px;">
                            Selecciona el tema de color que prefieras para tu portal
                        </p>
                        <div class="theme-selector">
                            ${temas.map(tema => `
                                <div class="theme-option ${config.tema === tema.id ? 'active' : ''}" 
                                     onclick="ConfiguracionController.cambiarTema('${tema.id}')">
                                    <div class="theme-icon">${tema.icono}</div>
                                    <div class="theme-name">${tema.nombre}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        /**
         * Vista de Dashboard
         */
        class DashboardView {
            renderDashboard() {
                return `
                    <h2>Dashboard - Analítica Regional</h2>
                    <p class="dashboard-subtitle">Métricas de rendimiento en tiempo real por región</p>
                    
                    <div class="dashboard-cards">
                        <article class="region-card">
                            <div class="region-header">
                                <div class="region-info">
                                    <div class="region-indicator" style="background-color: #5350e9;"></div>
                                    <h3 class="region-name">Europa</h3>
                                </div>
                                <div class="region-value">842</div>
                            </div>
                            <div class="chart-container">
                                <svg class="chart-svg" viewBox="0 0 300 100" preserveAspectRatio="none">
                                    <defs>
                                        <linearGradient id="gradient1" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#5350e9;stop-opacity:0.3" />
                                            <stop offset="100%" style="stop-color:#5350e9;stop-opacity:0.05" />
                                        </linearGradient>
                                    </defs>
                                    <path class="chart-path" d="M 0,60 Q 25,50 50,40 T 100,30 T 150,45 T 200,35 T 250,50 T 300,40 L 300,100 L 0,100 Z" fill="url(#gradient1)" stroke="#5350e9" stroke-width="3" />
                                </svg>
                            </div>
                        </article>

                        <article class="region-card">
                            <div class="region-header">
                                <div class="region-info">
                                    <div class="region-indicator" style="background-color: #008b75;"></div>
                                    <h3 class="region-name">América</h3>
                                </div>
                                <div class="region-value">375</div>
                            </div>
                            <div class="chart-container">
                                <svg class="chart-svg" viewBox="0 0 300 100" preserveAspectRatio="none">
                                    <defs>
                                        <linearGradient id="gradient2" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#008b75;stop-opacity:0.3" />
                                            <stop offset="100%" style="stop-color:#008b75;stop-opacity:0.05" />
                                        </linearGradient>
                                    </defs>
                                    <path class="chart-path" d="M 0,50 Q 25,55 50,45 T 100,50 T 150,40 T 200,55 T 250,45 T 300,50 L 300,100 L 0,100 Z" fill="url(#gradient2)" stroke="#008b75" stroke-width="3" />
                                </svg>
                            </div>
                        </article>

                        <article class="region-card">
                            <div class="region-header">
                                <div class="region-info">
                                    <div class="region-indicator" style="background-color: #dc3545;"></div>
                                    <h3 class="region-name">Indonesia</h3>
                                </div>
                                <div class="region-value">1025</div>
                            </div>
                            <div class="chart-container">
                                <svg class="chart-svg" viewBox="0 0 300 100" preserveAspectRatio="none">
                                    <defs>
                                        <linearGradient id="gradient3" x1="0%" y1="0%" x2="0%" y2="100%">
                                            <stop offset="0%" style="stop-color:#dc3545;stop-opacity:0.3" />
                                            <stop offset="100%" style="stop-color:#dc3545;stop-opacity:0.05" />
                                        </linearGradient>
                                    </defs>
                                    <path class="chart-path" d="M 0,70 Q 25,65 50,55 T 100,45 T 150,60 T 200,50 T 250,65 T 300,55 L 300,100 L 0,100 Z" fill="url(#gradient3)" stroke="#dc3545" stroke-width="3" />
                                </svg>
                            </div>
                        </article>
                    </div>
                `;
            }
        }

        /**
         * Vista de Perfiles
         */
        class PerfilView {
            renderGestionPerfiles(perfiles) {
                return `
                    <h2>Gestión de Perfiles de Usuario</h2>
                    <p style="color: #7f8c8d; margin-bottom: 30px;">
                        Administra los perfiles del sistema y sus permisos de acceso
                    </p>

                    <div class="info-box">
                        <p>
                            <strong>📋 Información:</strong> Los perfiles determinan qué funcionalidades del portal puede acceder cada usuario. 
                            Haz clic en "Editar" para modificar los permisos de cada perfil.
                        </p>
                    </div>

                    <div style="overflow-x: auto; margin-top: 30px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Perfil</th>
                                    <th>Descripción</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${perfiles.map(perfil => `
                                    <tr>
                                        <td><strong style="color: #3498db;">${perfil.nombre}</strong></td>
                                        <td>${perfil.descripcion}</td>
                                        <td>
                                            <button class="btn btn-primary" onclick="PerfilController.mostrarEdicionPerfil('${perfil.nombre}')" style="padding: 6px 12px; font-size: 13px;">
                                                ✏️ Editar Permisos
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top: 30px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 15px; color: #2c3e50;">Descripción de Perfiles</h3>
                        
                        <div style="display: grid; gap: 15px;">
                            <div style="padding: 15px; background: #e8f4f8; border-left: 4px solid #3498db; border-radius: 4px;">
                                <strong style="color: #2c3e50;">👑 Master:</strong> 
                                <span style="color: #555;">Acceso total al sistema, incluida la configuración avanzada y gestión de perfiles.</span>
                            </div>
                            
                            <div style="padding: 15px; background: #e8f4f8; border-left: 4px solid #27ae60; border-radius: 4px;">
                                <strong style="color: #2c3e50;">⚙️ Administrador:</strong> 
                                <span style="color: #555;">Gestión completa de ideas, seguimiento y catálogos. No tiene acceso a configuración del sistema.</span>
                            </div>
                            
                            <div style="padding: 15px; background: #e8f4f8; border-left: 4px solid #f39c12; border-radius: 4px;">
                                <strong style="color: #2c3e50;">👔 Gerente:</strong> 
                                <span style="color: #555;">Visualización de seguimiento, dashboards y cronogramas. Puede registrar ideas pero no gestionar cat  logos.</span>
                            </div>
                            
                            <div style="padding: 15px; background: #e8f4f8; border-left: 4px solid #95a5a6; border-radius: 4px;">
                                <strong style="color: #2c3e50;">👤 Colaborador:</strong> 
                                <span style="color: #555;">Solo puede registrar y ver sus propias ideas de mejora.</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderEdicionPerfil(perfil) {
                const modulos = [
                    { 
                        key: 'ideasMejora', 
                        label: 'Ideas de Mejora', 
                        icon: '💡',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'registrar', label: 'Registrar ideas' },
                            { key: 'modificar', label: 'Modificar ideas' },
                            { key: 'eliminar', label: 'Eliminar ideas' },
                            { key: 'verTodas', label: 'Ver todas las ideas (o solo las propias)' }
                        ]
                    },
                    { 
                        key: 'administrarPerfiles', 
                        label: 'Administrar Perfiles', 
                        icon: '👤',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'modificar', label: 'Modificar perfiles de usuario' }
                        ]
                    },
                    { 
                        key: 'seguimiento', 
                        label: 'Seguimiento', 
                        icon: '📊',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'modificar', label: 'Modificar información de seguimiento' },
                            { key: 'exportar', label: 'Exportar datos' }
                        ]
                    },
                    { 
                        key: 'agenda', 
                        label: 'Agenda Electrónica', 
                        icon: '📅',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'crear', label: 'Crear eventos' },
                            { key: 'modificar', label: 'Modificar eventos' },
                            { key: 'eliminar', label: 'Eliminar eventos' }
                        ]
                    },
                    { 
                        key: 'cronograma', 
                        label: 'Cronograma', 
                        icon: '📈',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'modificar', label: 'Modificar cronograma' },
                            { key: 'exportar', label: 'Exportar cronograma' }
                        ]
                    },
                    { 
                        key: 'dashboard', 
                        label: 'Dashboard', 
                        icon: '📉',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'exportar', label: 'Exportar reportes' }
                        ]
                    },
                    { 
                        key: 'catalogos', 
                        label: 'Catálogos', 
                        icon: '📚',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'agregar', label: 'Agregar opciones' },
                            { key: 'eliminar', label: 'Eliminar opciones' }
                        ]
                    },
                    { 
                        key: 'configuracion', 
                        label: 'Configuración', 
                        icon: '⚙️',
                        acciones: [
                            { key: 'acceso', label: 'Acceso al módulo' },
                            { key: 'gestionPerfiles', label: 'Gestión de perfiles del sistema' }
                        ]
                    }
                ];

                return `
                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-secondary" onclick="PerfilController.mostrarGestionPerfiles()" style="margin-bottom: 15px;">
                            ← Volver a Gestión de Perfiles
                        </button>
                    </div>

                    <form id="formEditarPerfil" onsubmit="PerfilController.guardarPermisos(event, '${perfil.nombre}')">
                        <h2 style="margin-bottom: 20px; color: #2c3e50;">
                            Editar Permisos: <span style="color: #3498db;">${perfil.nombre}</span>
                        </h2>
                        
                        <div class="form-group">
                            <label for="descripcionPerfil">Descripción del Perfil</label>
                            <textarea id="descripcionPerfil" rows="3" style="resize: vertical;">${perfil.descripcion}</textarea>
                        </div>

                        <div style="margin-top: 30px;">
                            <h3 style="margin-bottom: 20px; color: #2c3e50;">Permisos por Módulo</h3>
                            <div class="permisos-grid">
                                ${modulos.map(modulo => `
                                    <div class="permiso-card">
                                        <div class="permiso-modulo-titulo">
                                            ${modulo.icon} ${modulo.label}
                                        </div>
                                        ${modulo.acciones.map(accion => `
                                            <div class="permiso-accion">
                                                <input type="checkbox" 
                                                       id="${modulo.key}_${accion.key}" 
                                                       name="${modulo.key}_${accion.key}" 
                                                       ${perfil.permisos[modulo.key][accion.key] ? 'checked' : ''}>
                                                <label for="${modulo.key}_${accion.key}">${accion.label}</label>
                                            </div>
                                        `).join('')}
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 30px;">
                            <button type="submit" class="btn btn-success">💾 Guardar Permisos</button>
                            <button type="button" class="btn btn-secondary" onclick="PerfilController.mostrarGestionPerfiles()">Cancelar</button>
                        </div>
                    </form>
                `;
            }
        }

        // =============================================
        // CONTROLADORES (Controllers)
        // =============================================

        /**
         * Controlador de UI General
         */
        class UIController {
            static toggleSubmenu(menuId) {
                const submenu = document.getElementById(menuId);
                const arrow = document.getElementById(menuId.replace('-menu', '-arrow'));
                submenu.classList.toggle('open');
                arrow.classList.toggle('rotated');
            }

            static toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                sidebar.classList.toggle('open');
                overlay.classList.toggle('open');
            }

            static cerrarSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebarOverlay');
                sidebar.classList.remove('open');
                overlay.classList.remove('open');
            }

            static abrirModal(titulo, contenido) {
                document.getElementById('modal-title').textContent = titulo;
                document.getElementById('modal-body').innerHTML = contenido;
                document.getElementById('modal').classList.add('open');
            }

            static cerrarModal() {
                document.getElementById('modal').classList.remove('open');
            }

            static mostrarToast(mensaje, tipo = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${tipo}`;
                toast.textContent = mensaje;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            static mostrarConfirmacion(mensaje, onConfirm) {
                const confirmDiv = document.createElement('div');
                confirmDiv.innerHTML = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;">
                        <div style="background: white; padding: 30px; border-radius: 8px; max-width: 400px;">
                            <h3 style="margin-bottom: 15px; color: #e74c3c;">¿Confirmar acción?</h3>
                            <p style="margin-bottom: 20px; color: #555;">${mensaje}</p>
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="this.closest('div').parentElement.parentElement.remove()">Cancelar</button>
                                <button class="btn btn-danger" id="confirmBtn">Confirmar</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(confirmDiv);
                
                document.getElementById('confirmBtn').onclick = () => {
                    confirmDiv.remove();
                    onConfirm();
                };
            }

            static renderizar(contenido) {
                document.getElementById('main').innerHTML = contenido;
            }

            static salir() {
                this.mostrarConfirmacion('¿Está seguro que desea salir?', () => {
                    location.reload();
                });
            }

            static actualizarInfoUsuario(usuario) {
                document.getElementById('userInfo').innerHTML = `
                    Usuario: ${usuario.colaborador}<br>
                    <span style="font-size: 12px; color: #95a5a6;">Puesto: ${usuario.puesto} | Área: ${usuario.area}</span>
                `;
            }

            static irAPantallaPrincipal() {
                this.cerrarSidebar();
                this.renderizar('<h2>Bienvenido al Portal Corporativo</h2><p>Selecciona una opción del men   para comenzar.</p>');
            }
        }

        /**
         * Controlador de Perfiles
         */
        class PerfilController {
            static mostrarGestionPerfiles() {
                const perfiles = app.perfilModel.obtenerTodos();
                const vista = new PerfilView();
                UIController.renderizar(vista.renderGestionPerfiles(perfiles));
            }

            static mostrarEdicionPerfil(nombrePerfil) {
                const perfil = app.perfilModel.obtenerPerfil(nombrePerfil);
                if (!perfil) {
                    UIController.mostrarToast('Perfil no encontrado', 'error');
                    return;
                }
                
                const vista = new PerfilView();
                UIController.renderizar(vista.renderEdicionPerfil(perfil));
            }

            static guardarPermisos(event, nombrePerfil) {
                event.preventDefault();
                
                const descripcion = document.getElementById('descripcionPerfil').value;
                
                const permisos = {
                    ideasMejora: {
                        acceso: document.getElementById('ideasMejora_acceso').checked,
                        registrar: document.getElementById('ideasMejora_registrar').checked,
                        modificar: document.getElementById('ideasMejora_modificar').checked,
                        eliminar: document.getElementById('ideasMejora_eliminar').checked,
                        verTodas: document.getElementById('ideasMejora_verTodas').checked
                    },
                    administrarPerfiles: {
                        acceso: document.getElementById('administrarPerfiles_acceso').checked,
                        modificar: document.getElementById('administrarPerfiles_modificar').checked
                    },
                    seguimiento: {
                        acceso: document.getElementById('seguimiento_acceso').checked,
                        modificar: document.getElementById('seguimiento_modificar').checked,
                        exportar: document.getElementById('seguimiento_exportar').checked
                    },
                    agenda: {
                        acceso: document.getElementById('agenda_acceso').checked,
                        crear: document.getElementById('agenda_crear').checked,
                        modificar: document.getElementById('agenda_modificar').checked,
                        eliminar: document.getElementById('agenda_eliminar').checked
                    },
                    cronograma: {
                        acceso: document.getElementById('cronograma_acceso').checked,
                        modificar: document.getElementById('cronograma_modificar').checked,
                        exportar: document.getElementById('cronograma_exportar').checked
                    },
                    dashboard: {
                        acceso: document.getElementById('dashboard_acceso').checked,
                        exportar: document.getElementById('dashboard_exportar').checked
                    },
                    catalogos: {
                        acceso: document.getElementById('catalogos_acceso').checked,
                        agregar: document.getElementById('catalogos_agregar').checked,
                        eliminar: document.getElementById('catalogos_eliminar').checked
                    },
                    configuracion: {
                        acceso: document.getElementById('configuracion_acceso').checked,
                        gestionPerfiles: document.getElementById('configuracion_gestionPerfiles').checked
                    }
                };
                
                app.perfilModel.actualizarPerfil(nombrePerfil, descripcion, permisos);
                
                UIController.mostrarToast('✓ Permisos actualizados exitosamente');
                
                if (app.usuarioModel.getPerfil() === nombrePerfil) {
                    app.renderizarMenu();
                }
                
                this.mostrarGestionPerfiles();
            }
        }

        /**
         * Controlador de Usuario
         */
        class UsuarioController {
            static mostrarPerfil() {
                const usuario = app.usuarioModel.getInfo();
                const vista = new UsuarioView();
                UIController.renderizar(vista.renderPerfil(usuario));
            }

            static guardarPerfil(event) {
                event.preventDefault();
                const nuevoPerfil = document.getElementById('perfil').value;
                app.usuarioModel.setPerfil(nuevoPerfil);
                
                UIController.mostrarToast('✓ Perfil actualizado exitosamente');
                
                app.renderizarMenu();
            }
        }

        /**
         * Controlador de Catálogos
         */
        class CatalogoController {
            static mostrarMenuCatalogos() {
                const vista = new CatalogoView();
                UIController.renderizar(vista.renderMenuCatalogos());
            }

            static mostrarCatalogo(nombreCatalogo) {
                const catalogos = app.catalogoModel.obtenerTodosCatalogos();
                const vista = new CatalogoView();
                const perfilActual = app.usuarioModel.getPerfil();
                
                let titulo = '';
                if (nombreCatalogo === 'fuentesGeneracion') {
                    titulo = 'Fuentes de Generación';
                } else if (nombreCatalogo === 'impactos') {
                    titulo = 'Impactos';
                } else if (nombreCatalogo === 'areas') {
                    titulo = 'Áreas y Nomenclaturas';
                }
                
                UIController.renderizar(vista.renderCatalogoIndividual(titulo, nombreCatalogo, catalogos[nombreCatalogo], perfilActual));
            }

            static agregarOpcion(event, catalogo) {
                event.preventDefault();
                
                const perfilActual = app.usuarioModel.getPerfil();
                if (!app.perfilModel.tienePermiso(perfilActual, 'catalogos', 'agregar')) {
                    UIController.mostrarToast('No tienes permisos para agregar opciones', 'error');
                    return;
                }
                
                let nuevaOpcion;
                
                if (catalogo === 'areas') {
                    const nombre = document.getElementById('nueva-area-nombre').value.trim();
                    const nomenclatura = document.getElementById('nueva-area-nomenclatura').value.trim().toUpperCase();
                    
                    if (nombre && nomenclatura) {
                        nuevaOpcion = { nombre, nomenclatura };
                    }
                } else {
                    const input = document.getElementById(`nueva-${catalogo}`);
                    nuevaOpcion = input.value.trim();
                }
                
                if (nuevaOpcion) {
                    const resultado = app.catalogoModel.agregarOpcion(catalogo, nuevaOpcion);
                    if (resultado) {
                        UIController.mostrarToast('✓ Opción agregada exitosamente');
                        this.mostrarCatalogo(catalogo);
                    } else {
                        UIController.mostrarToast('Esta opción ya existe', 'error');
                    }
                }
            }

            static eliminarOpcion(catalogo, opcion) {
                const perfilActual = app.usuarioModel.getPerfil();
                if (!app.perfilModel.tienePermiso(perfilActual, 'catalogos', 'eliminar')) {
                    UIController.mostrarToast('No tienes permisos para eliminar opciones', 'error');
                    return;
                }
                
                UIController.mostrarConfirmacion(
                    `¿Está seguro de eliminar "${opcion}"?`,
                    () => {
                        app.catalogoModel.eliminarOpcion(catalogo, opcion);
                        UIController.mostrarToast('✓ Opción eliminada');
                        this.mostrarCatalogo(catalogo);
                    }
                );
            }
        }

        /**
         * Controlador de Ciclos
         */
        class CicloController {
            static mostrarFormularioRegistro() {
                const perfilActual = app.usuarioModel.getPerfil();
                if (!app.perfilModel.tienePermiso(perfilActual, 'ideasMejora', 'registrar')) {
                    UIController.mostrarToast('No tienes permisos para registrar ideas', 'error');
                    return;
                }
                
                const usuario = app.usuarioModel.getInfo();
                const fuentesGeneracion = app.catalogoModel.obtenerCatalogo('fuentesGeneracion');
                const impactos = app.catalogoModel.obtenerCatalogo('impactos');
                const vista = new CicloView();
                UIController.renderizar(vista.renderFormularioRegistro(usuario.colaborador, fuentesGeneracion, impactos));
            }

            static async guardarCiclo(event) {
                event.preventDefault();
                
                const usuario = app.usuarioModel.getInfo();
                const nomenclatura = app.catalogoModel.obtenerNomenclaturaArea(usuario.area);
                
                if (!nomenclatura) {
                    UIController.mostrarToast(`Error: El área "${usuario.area}" no tiene nomenclatura asignada. Por favor agrégala en Catálogos > Áreas.`, 'error');
                    return;
                }
                
                const fileInput = document.getElementById('documentacion');
                
                const documentos = [];
                if (fileInput.files.length > 0) {
                    for (let i = 0; i < fileInput.files.length; i++) {
                        const file = fileInput.files[i];
                        const dataUrl = await this.leerArchivo(file);
                        documentos.push({
                            nombre: file.name,
                            tipo: file.type,
                            tamano: file.size,
                            contenido: dataUrl
                        });
                    }
                }
                
                const cicloData = {
                    colaborador: usuario.colaborador,
                    clave: usuario.clave,
                    puesto: usuario.puesto,
                    area: usuario.area,
                    gerencia: usuario.gerencia,
                    nomenclatura: nomenclatura,
                    fuenteGeneracion: document.getElementById('fuenteGeneracion').value,
                    descripcionIdea: document.getElementById('descripcionIdea').value,
                    situacionActual: document.getElementById('situacionActual').value,
                    impacto: document.getElementById('impacto').value,
                    documentos: documentos
                };
                
                app.cicloModel.crear(cicloData);
                UIController.mostrarToast('✓ Idea de mejora guardada exitosamente');
                document.getElementById('formCiclo').reset();
            }

            static leerArchivo(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            static mostrarListado() {
                const usuario = app.usuarioModel.getInfo();
                const perfilActual = usuario.perfil;
                const verTodas = app.perfilModel.tienePermiso(perfilActual, 'ideasMejora', 'verTodas');
                
                let ciclos;
                
                if (verTodas) {
                    ciclos = app.cicloModel.obtenerTodos();
                } else {
                    ciclos = app.cicloModel.obtenerPorColaborador(usuario.colaborador);
                }
                
                const vista = new CicloView();
                UIController.renderizar(vista.renderListado(ciclos, perfilActual));
            }

            static mostrarFormularioModificacion(id) {
                const perfilActual = app.usuarioModel.getPerfil();
                if (!app.perfilModel.tienePermiso(perfilActual, 'ideasMejora', 'modificar')) {
                    UIController.mostrarToast('No tienes permisos para modificar ideas', 'error');
                    return;
                }
                
                const ciclo = app.cicloModel.obtenerPorId(id);
                if (!ciclo) return;
                
                const fuentesGeneracion = app.catalogoModel.obtenerCatalogo('fuentesGeneracion');
                const impactos = app.catalogoModel.obtenerCatalogo('impactos');
                const vista = new CicloView();
                UIController.renderizar(vista.renderFormularioModificacion(ciclo, fuentesGeneracion, impactos));
            }

            static async guardarModificacion(event, id) {
                event.preventDefault();
                
                const cicloActual = app.cicloModel.obtenerPorId(id);
                const fileInput = document.getElementById('documentacion');
                
                let documentos = cicloActual.documentos || [];
                if (fileInput.files.length > 0) {
                    for (let i = 0; i < fileInput.files.length; i++) {
                        const file = fileInput.files[i];
                        const dataUrl = await this.leerArchivo(file);
                        documentos.push({
                            nombre: file.name,
                            tipo: file.type,
                            tamano: file.size,
                            contenido: dataUrl
                        });
                    }
                }
                
                const cicloData = {
                    fuenteGeneracion: document.getElementById('fuenteGeneracion').value,
                    descripcionIdea: document.getElementById('descripcionIdea').value,
                    situacionActual: document.getElementById('situacionActual').value,
                    impacto: document.getElementById('impacto').value,
                    requiereDesarrolloTI: document.getElementById('requiereDesarrolloTI').value,
                    documentos: documentos
                };
                
                app.cicloModel.actualizar(id, cicloData);
                UIController.mostrarToast('✓ Idea de mejora modificada exitosamente');
                this.mostrarListado();
            }

            static confirmarEliminacion(id) {
                const perfilActual = app.usuarioModel.getPerfil();
                if (!app.perfilModel.tienePermiso(perfilActual, 'ideasMejora', 'eliminar')) {
                    UIController.mostrarToast('No tienes permisos para eliminar ideas', 'error');
                    return;
                }
                
                UIController.mostrarConfirmacion(
                    'Esta acción no se puede deshacer.',
                    () => {
                        app.cicloModel.eliminar(id);
                        UIController.mostrarToast('✓ Idea de mejora eliminada', 'error');
                        this.mostrarListado();
                    }
                );
            }

            static aplicarFiltros() {
                const searchInput = document.getElementById('searchInput').value.toLowerCase().trim();
                const searchColumn = document.getElementById('searchColumn').value;
                const estatusFilter = document.getElementById('estatusFilter').value;
                const fechaDesde = document.getElementById('fechaDesde').value;
                const fechaHasta = document.getElementById('fechaHasta').value;
                
                const filas = document.querySelectorAll('.fila-ciclo');
                let registrosMostrados = 0;
                
                filas.forEach(fila => {
                    let mostrar = true;
                    
                    // Filtro por estatus
                    if (estatusFilter !== 'todos') {
                        const estatus = fila.getAttribute('data-estatus');
                        if (estatus !== estatusFilter) {
                            mostrar = false;
                        }
                    }
                    
                    // Filtro por rango de fechas
                    if ((fechaDesde || fechaHasta) && mostrar) {
                        const fechaRegistro = fila.getAttribute('data-fecha');
                        // Convertir fecha en formato DD/MM/YYYY a YYYY-MM-DD para comparación
                        const partes = fechaRegistro.split('/');
                        const fechaFormateada = `${partes[2]}-${partes[1]}-${partes[0]}`;
                        
                        if (fechaDesde && fechaFormateada < fechaDesde) {
                            mostrar = false;
                        }
                        if (fechaHasta && fechaFormateada > fechaHasta) {
                            mostrar = false;
                        }
                    }
                    
                    // Filtro por búsqueda de texto
                    if (searchInput && mostrar) {
                        if (searchColumn === 'todos') {
                            // Buscar en todas las columnas
                            const codigo = fila.getAttribute('data-codigo').toLowerCase();
                            const colaborador = fila.getAttribute('data-colaborador').toLowerCase();
                            const area = fila.getAttribute('data-area').toLowerCase();
                            const puesto = fila.getAttribute('data-puesto').toLowerCase();
                            const fuente = fila.getAttribute('data-fuente').toLowerCase();
                            const descripcion = fila.getAttribute('data-descripcion').toLowerCase();
                            const impacto = fila.getAttribute('data-impacto').toLowerCase();
                            
                            if (!codigo.includes(searchInput) && 
                                !colaborador.includes(searchInput) && 
                                !area.includes(searchInput) && 
                                !puesto.includes(searchInput) && 
                                !fuente.includes(searchInput) && 
                                !descripcion.includes(searchInput) && 
                                !impacto.includes(searchInput)) {
                                mostrar = false;
                            }
                        } else {
                            // Buscar en columna específica
                            const valor = fila.getAttribute('data-' + searchColumn).toLowerCase();
                            if (!valor.includes(searchInput)) {
                                mostrar = false;
                            }
                        }
                    }
                    
                    fila.style.display = mostrar ? '' : 'none';
                    if (mostrar) registrosMostrados++;
                });
                
                // Actualizar contador de registros mostrados
                document.getElementById('registrosMostrados').textContent = registrosMostrados;
            }

            static limpiarFiltros() {
                document.getElementById('searchInput').value = '';
                document.getElementById('searchColumn').value = 'todos';
                document.getElementById('estatusFilter').value = 'todos';
                document.getElementById('fechaDesde').value = '';
                document.getElementById('fechaHasta').value = '';
                this.aplicarFiltros();
                UIController.mostrarToast('✓ Filtros limpiados');
            }

            static verDocumentos(id) {
                const ciclo = app.cicloModel.obtenerPorId(id);
                if (!ciclo || !ciclo.documentos || ciclo.documentos.length === 0) {
                    UIController.mostrarToast('No hay documentos para mostrar', 'error');
                    return;
                }

                const getIcono = (tipo) => {
                    if (tipo.includes('pdf')) return '📄';
                    if (tipo.includes('word') || tipo.includes('document')) return '📝';
                    if (tipo.includes('excel') || tipo.includes('spreadsheet')) return '📊';
                    if (tipo.includes('powerpoint') || tipo.includes('presentation')) return '📽️';
                    if (tipo.includes('image')) return '🖼️';
                    if (tipo.includes('text')) return '   ';
                    return '📎';
                };

                const formatearTamano = (bytes) => {
                    if (bytes < 1024) return bytes + ' B';
                    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
                    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
                };

                let contenido = `
                    <h3 style="margin-bottom: 20px;">Documentos de: ${ciclo.codigo}</h3>
                    <div style="max-height: 500px; overflow-y: auto;">
                `;

                ciclo.documentos.forEach((doc, index) => {
                    const icono = getIcono(doc.tipo);
                    const puedePrevisualizar = doc.tipo.includes('pdf') || doc.tipo.includes('image');
                    
                    contenido += `
                        <div class="documento-item">
                            <div class="documento-info">
                                <div class="documento-icono">${icono}</div>
                                <div class="documento-detalles">
                                    <div class="documento-nombre">${doc.nombre}</div>
                                    <div class="documento-tamano">${formatearTamano(doc.tamano)}</div>
                                </div>
                            </div>
                            <div class="documento-acciones">
                                ${puedePrevisualizar ? 
                                    `<button class="btn btn-primary" onclick="CicloController.previsualizarDocumento(${id}, ${index})" style="padding: 6px 12px; font-size: 13px;">
                                        👁️ Vista Previa
                                    </button>` : 
                                    ''
                                }
                                <button class="btn btn-success" onclick="CicloController.descargarDocumento(${id}, ${index})" style="padding: 6px 12px; font-size: 13px;">
                                    ⬇️ Descargar
                                </button>
                            </div>
                        </div>
                    `;
                });

                contenido += '</div>';
                UIController.abrirModal('Documentación', contenido);
            }

            static previsualizarDocumento(cicloId, docIndex) {
                const ciclo = app.cicloModel.obtenerPorId(cicloId);
                const doc = ciclo.documentos[docIndex];

                let contenido = `
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-secondary" onclick="CicloController.verDocumentos(${cicloId})" style="margin-right: 10px;">
                            ← Volver a la lista
                        </button>
                        <button class="btn btn-success" onclick="CicloController.descargarDocumento(${cicloId}, ${docIndex})">
                            ⬇️ Descargar
                        </button>
                    </div>
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">${doc.nombre}</h4>
                `;

                if (doc.tipo.includes('pdf')) {
                    contenido += `<iframe src="${doc.contenido}" class="preview-frame"></iframe>`;
                } else if (doc.tipo.includes('image')) {
                    contenido += `<img src="${doc.contenido}" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" alt="${doc.nombre}">`;
                }

                UIController.abrirModal('Vista Previa', contenido);
            }

            static descargarDocumento(cicloId, docIndex) {
                const ciclo = app.cicloModel.obtenerPorId(cicloId);
                const doc = ciclo.documentos[docIndex];

                const link = document.createElement('a');
                link.href = doc.contenido;
                link.download = doc.nombre;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                UIController.mostrarToast('✓ Descargando archivo...');
            }
        }

        /**
         * Controlador de Seguimiento
         */
        class SeguimientoController {
            static mostrarSeguimiento() {
                const folios = app.folioModel.obtenerTodos();
                const vista = new SeguimientoView();
                UIController.renderizar(vista.renderListadoFolios(folios));
            }

            static mostrarDetalle(folio) {
                const detalle = app.folioModel.obtenerPorFolio(folio);
                const vista = new SeguimientoView();
                UIController.abrirModal(`Detalle del Folio ${folio}`, vista.renderDetalleFolio(detalle));
            }
        }

        /**
         * Controlador de Agenda
         */
        class AgendaController {
            static mostrarAgenda() {
                const eventos = app.eventoModel.obtenerTodos();
                const vista = new AgendaView();
                UIController.renderizar(vista.renderAgenda(eventos));
            }

            static abrirModalEvento() {
                const vista = new AgendaView();
                UIController.abrirModal('Agregar Actividad', vista.renderFormularioEvento());
            }

            static guardarEvento(event) {
                event.preventDefault();
                
                const eventoData = {
                    titulo: document.getElementById('tituloEvento').value,
                    fecha: document.getElementById('fechaEvento').value,
                    hora: document.getElementById('horaEvento').value,
                    descripcion: document.getElementById('descripcionEvento').value
                };
                
                app.eventoModel.crear(eventoData);
                UIController.cerrarModal();
                UIController.mostrarToast('✓ Evento guardado exitosamente');
                this.mostrarAgenda();
            }
        }

        /**
         * Controlador de Cronograma
         */
        class CronogramaController {
            static mostrarCronograma() {
                const items = app.cronogramaModel.obtenerTodos();
                const vista = new CronogramaView();
                UIController.renderizar(vista.renderCronograma(items));
            }

            static aplicarFiltros() {
                const filterTipo = document.getElementById('filterTipo').value;
                const filterImplementador = document.getElementById('filterImplementador').value;
                const rows = document.querySelectorAll('.cronograma-row');
                
                rows.forEach(row => {
                    const tipo = row.getAttribute('data-tipo');
                    const implementador = row.getAttribute('data-implementador');
                    let mostrar = true;
                    
                    if (filterTipo && tipo !== filterTipo) mostrar = false;
                    if (filterImplementador && implementador !== filterImplementador) mostrar = false;
                    
                    row.style.display = mostrar ? '' : 'none';
                });
            }
        }

        /**
         * Controlador de Configuración
         */
        class ConfiguracionController {
            static mostrarConfiguracion() {
                const config = app.configuracionModel.getConfig();
                const vista = new ConfiguracionView();
                UIController.renderizar(vista.renderConfiguracion(config));
            }

            static subirLogo(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    app.configuracionModel.setLogo(e.target.result);
                    UIController.mostrarToast('✓ Logo actualizado exitosamente');
                    this.mostrarConfiguracion();
                    this.aplicarLogo();
                };
                reader.readAsDataURL(file);
            }

            static eliminarLogo() {
                app.configuracionModel.setLogo(null);
                UIController.mostrarToast('✓ Logo eliminado');
                this.mostrarConfiguracion();
                this.aplicarLogo();
            }

            static subirAvatar(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    app.configuracionModel.setAvatar(e.target.result);
                    UIController.mostrarToast('✓ Avatar actualizado exitosamente');
                    this.mostrarConfiguracion();
                    this.aplicarAvatar();
                };
                reader.readAsDataURL(file);
            }

            static eliminarAvatar() {
                app.configuracionModel.setAvatar(null);
                UIController.mostrarToast('✓ Avatar eliminado');
                this.mostrarConfiguracion();
                this.aplicarAvatar();
            }

            static cambiarTema(tema) {
                app.configuracionModel.setTema(tema);
                UIController.mostrarToast('✓ Tema cambiado exitosamente');
                this.aplicarTema();
                this.mostrarConfiguracion();
            }

            static aplicarLogo() {
                const config = app.configuracionModel.getConfig();
                const logoContainer = document.getElementById('logoContainer');
                const navbarLogoContainer = document.getElementById('navbarLogoContainer');
                const menuTitle = document.getElementById('menuTitle');
                
                if (config.logo) {
                    logoContainer.innerHTML = `<img src="${config.logo}" alt="Logo" class="portal-logo">`;
                    menuTitle.style.display = 'block';
                    
                    navbarLogoContainer.innerHTML = `<img src="${config.logo}" alt="Logo" class="navbar-logo">`;
                } else {
                    logoContainer.innerHTML = '';
                    navbarLogoContainer.innerHTML = '';
                    menuTitle.style.display = 'block';
                }
            }

            static aplicarAvatar() {
                const usuario = app.usuarioModel.getInfo();
                const config = app.configuracionModel.getConfig();
                const userInfo = document.getElementById('userInfo');
                
                if (config.avatar) {
                    userInfo.innerHTML = `
                        <img src="${config.avatar}" alt="Avatar" class="user-avatar">
                        <div class="user-details">
                            <span style="font-weight: 600; color: #2c3e50;">Usuario: ${usuario.colaborador}</span>
                            <span style="font-size: 12px; color: #95a5a6;">Puesto: ${usuario.puesto} |   rea: ${usuario.area}</span>
                        </div>
                    `;
                } else {
                    userInfo.innerHTML = `
                        Usuario: ${usuario.colaborador}<br>
                        <span style="font-size: 12px; color: #95a5a6;">Puesto: ${usuario.puesto} | Área: ${usuario.area}</span>
                    `;
                }
            }

            static aplicarTema() {
                const config = app.configuracionModel.getConfig();
                const body = document.body;
                
                body.classList.remove('tema-claro', 'tema-oscuro');
                
                if (config.tema === 'claro') {
                    body.classList.add('tema-claro');
                } else if (config.tema === 'oscuro') {
                    body.classList.add('tema-oscuro');
                }
            }

            static inicializarConfiguracion() {
                this.aplicarLogo();
                this.aplicarAvatar();
                this.aplicarTema();
            }
        }

        /**
         * Controlador de Dashboard
         */
        class DashboardController {
            static mostrarDashboard() {
                const vista = new DashboardView();
                UIController.renderizar(vista.renderDashboard());
            }
        }

        // =============================================
        // APLICACIÓN PRINCIPAL
        // =============================================

        /**
         * Clase principal de la aplicación
         */
        class App {
            constructor() {
                this.usuarioModel = new UsuarioModel();
                this.catalogoModel = new CatalogoModel();
                this.cicloModel = new CicloModel();
                this.eventoModel = new EventoModel();
                this.folioModel = new FolioModel();
                this.cronogramaModel = new CronogramaModel();
                this.configuracionModel = new ConfiguracionModel();
                this.perfilModel = new PerfilModel();
                
                this.menuView = new MenuView();
            }

            init() {
                this.renderizarMenu();
                UIController.actualizarInfoUsuario(this.usuarioModel.getInfo());
                UIController.renderizar('<h2>Bienvenido al Portal Corporativo</h2><p>Selecciona una opción del menú para comenzar.</p>');
                
                ConfiguracionController.inicializarConfiguracion();
                
                document.addEventListener('click', (event) => {
                    const modal = document.getElementById('modal');
                    if (event.target === modal) {
                        UIController.cerrarModal();
                    }
                });
            }

            renderizarMenu() {
                const perfil = this.usuarioModel.getPerfil();
                document.getElementById('menuNav').innerHTML = this.menuView.renderMenu(perfil);
            }
        }

        const app = new App();
        
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9be62e25b00beafe',t:'MTc2ODQ4ODU3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>